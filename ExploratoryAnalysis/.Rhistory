us_states$names <- gsub("\\:.*", "", us_states$names)
states <- data.table(us_states$names)
colnames(states) <- "statename"
return(states)
}
leg <- function(leg_title="",boxColours){
pushViewport(viewport(x=0.25,y=0.8,width=1,height=0.2))
grid.text(leg_title,gp=gpar(lwd=3,fontsize=15))
popViewport()
nlabels <- 11
pushViewport(viewport(layout = grid.layout(1, 2,
widths = unit.c(unit(0.2,"npc"), unit(0.8,"npc")))))
pushViewport(viewport(layout.pos.col=1))
pushViewport(viewport(x=0, y=0.45, width=1,height=0.5))
vp_grid <- viewport(layout = grid.layout(nlabels, 1))
pushViewport(vp_grid)
for (i in 1:nlabels) {
pushViewport(viewport(layout.pos.row = i))
grid.rect(gp = gpar(col=boxColours[i],fill = boxColours[i]))
popViewport()
}
popViewport(3)
pushViewport(viewport(layout.pos.col=2))
pushViewport(viewport(x=0.5, y=0.45, width=1,height=0.5))
pushViewport(vp_grid)
newlabels <- seq(-10,10,by=2)
for (i in  1:nlabels){
pushViewport(viewport(layout.pos.row = i))
grid.text(i-1)
popViewport()
}
popViewport(4)
}
state_flu_activity <- function(us_states,main_title="",cols,boxColours){
grid.newpage()
if (main_title!=""){
heights <- unit.c(unit(0.05,"npc"),unit(0.95,"npc"))
} else{
heights <- unit.c(unit(0,"npc"),unit(1,"npc"))
}
pushViewport(viewport(layout = grid.layout(2, 1, heights=heights)))
pushViewport(viewport(layout.pos.row=1))
grid.text(main_title,y=unit(-0.2,"npc"),gp=gpar(lwd=3,fontsize=20),just="centre")
popViewport()
pushViewport(viewport(layout.pos.row=2))
pushViewport(viewport(layout = grid.layout(1, 2,
widths = unit.c(unit(0.9,"npc"), unit(0.1,"npc")))))
#plot legend
pushViewport(viewport(layout.pos.col=2))
leg(leg_title="Flu activity level",boxColours)
popViewport()
#plot map & hexbin
pushViewport(viewport(layout.pos.col=1))
width <- 4
height <- 2
xbnds <- us_states$range[1:2]
ybnds <- us_states$range[3:4]
xrange <- range(xbnds)+ width/2*c(-1,0.2)
yrange <- range(ybnds) + height/2*c(-1,0.2)
vp <- viewport(x=0.5,y=0.5,width=0.9,height=0.85,
xscale=xrange,yscale=yrange)
pushViewport(vp)
grid.xaxis()
grid.yaxis()
popViewport()
pushViewport(viewport(x=0.5, y=0.5, width=0.9, height=0.85,
xscale=xrange, yscale=yrange, clip="on"))
single_states <- c(1,which(is.na(us_states$x)),length(us_states$x)) #get index boundaries of single state data frames
for (i in 2:(length(single_states))){
grid.polygon(unit(us_states$x[single_states[i-1]:single_states[i]],"native"),unit(us_states$y[single_states[i-1]:single_states[i]],"native"),
gp=gpar(col="black",fill=cols[i-1]))
}
popViewport(2)
}
plot_flu_states <- function(data,filename="animation.avi",nat_reg=F) {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
if (nat_reg==T){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
states$national <- "National"
}
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Minimal","Low","Moderate","High","Insufficient Data")
leg_nr <- c("1-3: ","4-5: ","6-7: ","8-10: ","0: ")
leg_lab <- paste0(leg_nr,leg_lab)
leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("white", "yellow","red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
if (nat_reg == T){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
flu_cols <- c(rep("red",20),rep("green",20),rep("blue",24))
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
plot_flu_diff_states <- function(data,filename="animation.mp4") {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Twitter overestimated","spot on","Twitter underestimated")
leg_nr <- c("-10: ","0: ","10: ")
leg_lab <- paste0(leg_nr,leg_lab)
#leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("blue", "white", "red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
plot_flu_states(flu_aggregated,filename="twitter_flu.avi",nat_reg=nat_reg)
plot_flu_states <- function(data,filename="animation.avi",nat_reg=F) {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
if (nat_reg==T){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
states$national <- "National"
}
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Minimal","Low","Moderate","High","Insufficient Data")
leg_nr <- c("1-3: ","4-5: ","6-7: ","8-10: ","0: ")
leg_lab <- paste0(leg_nr,leg_lab)
leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("white", "yellow","red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
if (nat_reg == T){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
plot_flu_states(flu_aggregated,filename="twitter_flu.avi")
flu_aggregated
plot_flu_states(flu_aggregated,filename="twitter_flu.avi",nat_reg=rat_reg)
plot_flu_states(flu_aggregated,filename="twitter_flu.avi",nat_reg=nat_reg)
tag <- "regional"
plot_flu_states(flu_aggregated,filename=paste0(tag,"_twitter_flu.avi"),nat_reg=nat_reg)
plot_flu_states(cdc_data,filename=paste0(tag,"_cdc_flu.avi"),nat_reg=nat_reg)
merged_set <- merge(flu_aggregated,cdc_data,by=c("weekend","statename"))
merged_set$activity_level <- merged_set$activity_level.y-merged_set$activity_level.x
merged_set$activity_level <- (merged_set$activity_level+10)/2
merged_set$activity_level_label <- merged_set$activity_level_label.x
setkey(merged_set,weekend)
plot_flu_diff_states <- function(data,filename="animation.mp4",nat_reg=F) {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
if (nat_reg==T){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
states$national <- "National"
}
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Twitter overestimated","spot on","Twitter underestimated")
leg_nr <- c("-10: ","0: ","10: ")
leg_lab <- paste0(leg_nr,leg_lab)
#leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("blue", "white", "red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
plot_flu_diff_states(merged_set,filename=paste0(tag,"_Twitter_cdc_diff.avi"),nat_reg=nat_reg)
merged_set
plot_flu_diff_states <- function(data,filename="animation.mp4",nat_reg=F) {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
if (nat_reg==T){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
states$national <- "National"
}
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Twitter overestimated","spot on","Twitter underestimated")
leg_nr <- c("-10: ","0: ","10: ")
leg_lab <- paste0(leg_nr,leg_lab)
#leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("blue", "white", "red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
if (nat_reg == T){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
plot_flu_diff_states(merged_set,filename=paste0(tag,"_Twitter_cdc_diff.avi"),nat_reg=nat_reg)
flu_aggregated
state_flu_activity <- function(us_states,main_title="",cols,boxColours){
grid.newpage()
if (main_title!=""){
heights <- unit.c(unit(0.05,"npc"),unit(0.95,"npc"))
} else{
heights <- unit.c(unit(0,"npc"),unit(1,"npc"))
}
pushViewport(viewport(layout = grid.layout(2, 1, heights=heights)))
pushViewport(viewport(layout.pos.row=1))
grid.text(main_title,y=unit(-0.2,"npc"),gp=gpar(lwd=3,fontsize=20),just="centre")
popViewport()
pushViewport(viewport(layout.pos.row=2))
pushViewport(viewport(layout = grid.layout(1, 2,
widths = unit.c(unit(0.9,"npc"), unit(0.1,"npc")))))
#plot legend
pushViewport(viewport(layout.pos.col=2))
leg(leg_title="Flu activity level",boxColours)
popViewport()
#plot map & hexbin
pushViewport(viewport(layout.pos.col=1))
width <- 4
height <- 2
xbnds <- us_states$range[1:2]
ybnds <- us_states$range[3:4]
xrange <- range(xbnds)+ width/2*c(-1,0.2)
yrange <- range(ybnds) + height/2*c(-1,0.2)
vp <- viewport(x=0.5,y=0.5,width=0.9,height=0.85,
xscale=xrange,yscale=yrange)
pushViewport(vp)
grid.xaxis()
grid.yaxis()
popViewport()
pushViewport(viewport(x=0.5, y=0.5, width=0.9, height=0.85,
xscale=xrange, yscale=yrange, clip="on"))
single_states <- c(1,which(is.na(us_states$x)),length(us_states$x)) #get index boundaries of single state data frames
for (i in 2:(length(single_states))){
grid.polygon(unit(us_states$x[single_states[i-1]:single_states[i]],"native"),unit(us_states$y[single_states[i-1]:single_states[i]],"native"),
gp=gpar(col="black",fill=cols[i-1]))
}
popViewport(2)
}
nat_reg <- "regional"
plot_flu_states
nat_reg
plot_flu_states(flu_aggregated,filename=paste0(tag,"_twitter_flu.avi"),nat_reg=nat_reg)
nat_reg = "national"
tag <- "national"
flu_aggregated
data <- flu_aggregated
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
nat_reg
nat_reg = "regional"
if (nat_reg=="regional"){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
} else if (nat_reg == "national"){
data <- data[statename=="National",]
} else if (nat_reg != "state"){
stop("Variable 'nat_reg' must be specified with either 'national','regional' or 'state'")
}
weeks <- unique(data$weekend)
n <- length(weeks)
leg_lab <- c("Minimal","Low","Moderate","High","Insufficient Data")
leg_nr <- c("1-3: ","4-5: ","6-7: ","8-10: ","0: ")
leg_lab <- paste0(leg_nr,leg_lab)
leg_lab <- leg_lab[order(leg_lab)]
cr <- colour_ramp(c("white", "yellow","red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
i <- 10
temp <- data[weekend==weeks[i],]
if (nat_reg == "regional" || nat_reg =="national"){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
flu_cols
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
i <- 20
temp <- data[weekend==weeks[i],]
if (nat_reg == "regional" || nat_reg =="national"){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
plot_flu_states <- function(data,filename="animation.avi",nat_reg="state") {
data <-
data[, .(statename, activity_level, weekend, activity_level_label)]
states <- state_names()
if (nat_reg=="regional"){
colnames(data)[1] <- "region"
region_list <- list("Region 1" = c("connecticut","maine","massachusetts","new hampshire", "rhode island","vermont"),
"Region 2" = c("new jersey","new york","new york city","puerto rico","us virgin islands"),
"Region 3" = c("delaware", "district of columbia", "maryland", "pennsylvania", "virginia", "west virginia"),
"Region 4" = c("alabama","florida", "georgia", "kentucky", "mississippi", "north carolina", "south carolina", "tennessee"),
"Region 5" = c("illinois", "indiana", "michigan", "minnesota", "ohio", "wisconsin"),
"Region 6" = c("arkansas", "louisiana", "new mexico", "oklahoma", "texas"),
"Region 7" = c("iowa", "kansas", "missouri", "nebraska"),
"Region 8" = c("colorado", "montana", "north dakota", "south dakota", "utah", "wyoming"),
"Region 9" = c("arizona", "california", "hawaii", "nevada"),
"Region 10" = c("alaska", "idaho", "oregon", "washington"))
states$region <- NA
for (i in 1:length(region_list)){
states$region[which(states$statename %in% region_list[[i]])] <- names(region_list)[i]
}
} else if (nat_reg == "national"){
data <- data[statename=="National",]
} else if (nat_reg != "state"){
stop("Variable 'nat_reg' must be specified with either 'national','regional' or 'state'")
}
weeks <- unique(data$weekend)
n <- length(weeks)
#leg_ind <- c(0,1,4,6,8)
leg_lab <- c("Minimal","Low","Moderate","High","Insufficient Data")
leg_nr <- c("1-3: ","4-5: ","6-7: ","8-10: ","0: ")
leg_lab <- paste0(leg_nr,leg_lab)
leg_lab <- leg_lab[order(leg_lab)]
#define colourramp
cr <- colour_ramp(c("white", "yellow","red"))
legcols <- cr(seq(0,1,by=0.1))
ani.options("interval"=0.5)
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
if (nat_reg == "regional" || nat_reg =="national"){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
}
flu_aggregated
nat_reg
plot_flu_states(flu_aggregated,filename=paste0(nat_reg,"_twitter_flu.avi"),nat_reg=nat_reg)
nat_reg <- "national"
plot_flu_states(flu_aggregated,filename=paste0(nat_reg,"_twitter_flu.avi"),nat_reg=nat_reg)
plot_flu_states(flu_aggregated,filename=paste0(nat_reg,"_twitter_flu.avi"),nat_reg=nat_reg)
gc()
plot_flu_states(flu_aggregated,filename=paste0(nat_reg,"_twitter_flu.avi"),nat_reg=nat_reg)
plot_flu_states(cdc_data,filename=paste0(nat_reg,"_cdc_flu.avi"),nat_reg=nat_reg)
nat_reg
nat_reg <- "regional"
plot_flu_states(flu_aggregated,filename=paste0(nat_reg,"_twitter_flu.avi"),nat_reg=nat_reg)
nat_reg <- "national"
saveVideo({
for (i in 1:n) {
#prepare statemap
temp <- data[weekend==weeks[i],]
if (nat_reg == "regional" || nat_reg =="national"){
temp <- temp[,.(region,activity_level)]
temp <- merge(temp,states,by="region")
temp <- temp[order(statename)]
} else {
temp <- temp[,.(statename,activity_level)]
temp <- merge(temp,states,by="statename")
}
flu_cols <- cr(temp$activity_level / 10)
us_states <- map("state", plot=F,fill=T,col=flu_cols)
state_flu_activity(us_states,main_title=as.character(weeks[i]),cols=flu_cols,boxColours=legcols)
}
},video.name=filename,ani.width = 1000, ani.height = 600)
